{{ define "main" }}
<div class="section recipe-page">
    <div class="columns is-centered">
        <div class="column is-full-mobile is-two-thirds-desktop recipe-card">
            <div class="is-flex recipe-hero-wrap" style="justify-content: center; position: relative;">
                <div class="recipe-status-icons">
                    {{ if .Params.favourite }}
                        <span class="icon is-large has-text-warning">
                            <i class="fas fa-star"></i>
                        </span>
                    {{ end }}
                    {{ if .Params.queued }}
                        <span class="icon is-large">
                            <i class="fas fa-hourglass"></i>
                        </span>
                    {{ end }}
                </div>
                <figure class="image recipe-hero">
                    {{- $image_url := partial "asset-url.html" "/images/defaultImage.avif" -}}
                    {{- if and .Params.recipe_image (fileExists (printf "static/%s" .Params.recipe_image)) -}}
                        {{- $image_url = partial "asset-url.html" (printf "/%s" .Params.recipe_image) -}}
                    {{- end -}}
                    <img src="{{ $image_url }}" alt="Recipe image">
                    <div class="recipe-hero__gradient" aria-hidden="true"></div>
                    <div class="recipe-hero__title">
                        <h1 class="title is-bold has-text-white">{{ .Title }}</h1>
                        <div class="fodmap-indicator">
                            <div style="margin-top:.5rem;">{{ partial "fodmap-badge.html" . }}</div>
                        </div>
                    </div>
                    {{- $videoFileHref := "" -}}
                    {{- with .Params.video_file -}}
                        {{- $videoFileHref = partial "asset-url.html" (printf "/%s" .) -}}
                    {{- end -}}
                    {{- $youtubeHref := "" -}}
                    {{- with .Params.link -}}
                        {{- $youtubeHref = . -}}
                    {{- end -}}
                    {{- $modalId := printf "recipe-video-modal-%s" (anchorize .Title) -}}
                    {{ if or $youtubeHref $videoFileHref }}
                    <div id="mediaButtons" class="is-rounded media-badge media-badge--left">
                        {{ if $youtubeHref }}
                        <a href="{{ $youtubeHref }}" target="_blank" rel="noopener" aria-label="Otwórz wideo na YouTube">
                            <i class="fab fa-youtube" aria-hidden="true"></i>
                        </a>
                        {{ end }}
                        {{ if $videoFileHref }}
                        <button type="button" class="unstyled-btn" aria-label="Odtwórz lokalne wideo" data-video-modal-trigger="{{ $modalId }}">
                            <i class="fas fa-film" aria-hidden="true"></i>
                        </button>
                        {{ end }}
                    </div>
                    {{ end }}
                    <div id="shareButton" class="is-rounded media-badge media-badge--right">
                        <a href="/CookBook/admin/#/collections/recipes/entries/{{ .File.ContentBaseName }}" target="_blank" rel="noopener" aria-label="Edit recipe" class="unstyled-btn">
                            <i class="fas fa-pen-to-square" aria-hidden="true"></i>
                        </a>
                        <button onclick="shareRecipe()" aria-label="Share recipe" class="unstyled-btn">
                            <i class="fas fa-share-from-square" aria-hidden="true"></i>
                        </button>
                    </div>
                </figure>
            </div>

            {{ if $videoFileHref }}
            <div id="{{ $modalId }}" class="modal recipe-video-modal" role="dialog" aria-modal="true" aria-label="Odtwarzacz wideo" tabindex="-1">
                <div class="modal-background" data-video-modal-close></div>
                <div class="modal-content">
                    <div class="box recipe-video-modal__box">
                        <video class="recipe-video-modal__player" controls preload="metadata" data-video-modal-player>
                            <source src="{{ $videoFileHref }}" type="video/mp4">
                            Twoja przeglądarka nie wspiera odtwarzania wideo. Pobierz plik
                            <a href="{{ $videoFileHref }}">tutaj</a>.
                        </video>
                    </div>
                </div>
                <button class="modal-close is-large" aria-label="Zamknij wideo" data-video-modal-close></button>
            </div>
            {{ end }}

            

            <div class="container has-text-centered recipe-meta recipe-meta--stats">
                {{ partial "statstable.html" . }}
            </div>
            <hr class="recipe-sep">
            <div class="container has-text-centered recipe-meta recipe-meta--macros">
                {{ partial "macrostable.html" . }}
            </div>
            <hr>
            <p class="subtitle is-italic"> {{ .Params.Tagline }}</p>
            <div class="content">
                {{ .Content }}
            </div>
            {{/* FODMAP panel placed after content (below nutrition tables which precede .Content) */}}
            <div class="fodmap-indicator">
                {{ partial "fodmap-panel.html" . }}
            </div>
        </div>
    </div>
</div>
{{ end }}
