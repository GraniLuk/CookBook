{{ define "main" }}
<div class="page-section">
    <div class="page-container">
        <h1 class="title">Kolejka</h1>
        {{ $allPages := where site.RegularPages "Params.queued" "eq" true }}
        <p class="subtitle">{{ len $allPages }} {{ if eq (len $allPages) 1 }}przepis{{ else }}przepis√≥w{{ end }} w kolejce</p>
        
        {{/* Define category order - meal progression through the day */}}
        {{ $categoryOrder := slice "≈õniadania" "obiady" "kolacje" "sa≈Çatki" "desery" "napoje" "sosy" "przekƒÖski" }}
        
        {{/* Category display names */}}
        {{ $categoryNames := dict 
            "≈õniadania" "‚òï ≈öniadania"
            "obiady" "üçΩÔ∏è Obiady"
            "kolacje" "üåô Kolacje"
            "sa≈Çatki" "ü•ó Sa≈Çatki"
            "desery" "üç∞ Desery"
            "napoje" "ü•§ Napoje"
            "sosy" "ü´ô Sosy"
            "przekƒÖski" "üçø PrzekƒÖski"
        }}
        
        {{/* Also handle URL-friendly versions */}}
        {{ $categoryAliases := dict
            "salatki" "sa≈Çatki"
            "przekaski" "przekƒÖski"
        }}
        
        {{ range $category := $categoryOrder }}
            {{/* Filter pages by category - check both normal and aliased versions */}}
            {{ $categoryPages := where $allPages "Params.categories" $category }}
            {{/* Also check for URL-safe versions */}}
            {{ if eq $category "sa≈Çatki" }}
                {{ $aliasPages := where $allPages "Params.categories" "salatki" }}
                {{ $categoryPages = $categoryPages | union $aliasPages }}
            {{ end }}
            {{ if eq $category "przekƒÖski" }}
                {{ $aliasPages := where $allPages "Params.categories" "przekaski" }}
                {{ $categoryPages = $categoryPages | union $aliasPages }}
            {{ end }}
            
            {{ if gt (len $categoryPages) 0 }}
                {{/* Sort by title first (secondary key), then by priority (primary key) - Hugo stable sort maintains title order for same priority */}}
                {{ $sortedPages := sort $categoryPages ".Title" "asc" }}
                {{ $sortedPages = sort $sortedPages ".Params.priority" "desc" }}
                
                <div class="category-section">
                    <h2 class="category-header">{{ index $categoryNames $category }} <span class="category-count">({{ len $categoryPages }})</span></h2>
                    <div class="recipe-grid">
                        {{ range $sortedPages }}
                        <div>
                            {{ partial "summary.html" . }}
                        </div>
                        {{ end }}
                    </div>
                </div>
            {{ end }}
        {{ end }}
        
        {{/* Handle uncategorized recipes */}}
        {{ $categorized := slice }}
        {{ range $category := $categoryOrder }}
            {{ $categorized = $categorized | append $category }}
        {{ end }}
        {{ $categorized = $categorized | append "salatki" | append "przekaski" }}
        
        {{ $uncategorized := $allPages }}
        {{ range $cat := $categorized }}
            {{ $uncategorized = where $uncategorized "Params.categories" "ne" $cat }}
        {{ end }}
        
        {{ if gt (len $uncategorized) 0 }}
            <div class="category-section">
                <h2 class="category-header">üìã Inne <span class="category-count">({{ len $uncategorized }})</span></h2>
                <div class="recipe-grid">
                    {{/* Sort by title first (secondary key), then by priority (primary key) */}}
                    {{ $sortedUncategorized := sort $uncategorized ".Title" "asc" }}
                    {{ $sortedUncategorized = sort $sortedUncategorized ".Params.priority" "desc" }}
                    {{ range $sortedUncategorized }}
                    <div>
                        {{ partial "summary.html" . }}
                    </div>
                    {{ end }}
                </div>
            </div>
        {{ end }}
    </div>
</div>
{{ end }}